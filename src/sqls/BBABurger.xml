<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="BBABurger">

<!--재료 전체뽑아오기-->
<select id="getIngredientList" resultType="bba.com.a.model.Bb_IngredientDto">
SELECT A.SEQ, NAME, TYPES, PRICE ,CAL, A.DEL, B.SEQ AS IMAGE_SEQ, IMAGE_SRC, B.WHAT_IMAGE
FROM (SELECT * FROM BB_INGREDIENT WHERE DEL = 0) A,(SELECT * FROM BB_IMAGE WHERE WHAT_IMAGE='일러스트' AND TABLE_NAME='BB_INGREDIENT') B
WHERE A.SEQ = B.REF_SEQ
ORDER BY TYPES ASC
</select>

<!--버거 전체뽑아오기 -->
<select id="getBurgerList" resultType="bba.com.a.model.Bb_BurgerDto">
SELECT A.SEQ, NAME, TYPES, PRICE ,CAL, A.DEL, B.SEQ AS IMAGE_SEQ, IMAGE_SRC, B.WHAT_IMAGE
FROM (SELECT * FROM BB_INGREDIENT WHERE DEL = 0) A,(SELECT * FROM BB_IMAGE WHERE WHAT_IMAGE='일러스트' AND TABLE_NAME='BB_INGREDIENT') B
WHERE A.SEQ = B.REF_SEQ
</select>



<!--버거 삭제하기-->
<update id="deleteBurger" parameterType="java.lang.Integer">
UPDATE BB_BURGER
SET DEL=1
WHERE SEQ=#{seq}
</update>


<!--다해버거테이블-->
<select id="getBurgerListForBurgerTB" resultType="bba.com.a.model.Bb_BurgerDto">
SELECT A.SEQ, A.NAME, 
A.CREATOR , A.PRICE, A.CAL,A.DEL ,NVL(B.IMAGE_SRC, '없음') IMAGE_SRC,
A.BREAD, 
A.INGREDIENT01, A.INGREDIENT02, A.INGREDIENT03,
A.INGREDIENT04,A.INGREDIENT05,A.INGREDIENT06,
A.INGREDIENT07,A.INGREDIENT08,A.INGREDIENT09, NVL(C.NAME, '0') creatorID,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.BREAD) BREAD_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT01) INGREDIENT01_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT02) INGREDIENT02_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT03) INGREDIENT03_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT04) INGREDIENT04_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT05) INGREDIENT05_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT06) INGREDIENT06_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT07) INGREDIENT07_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT08) INGREDIENT08_NAME,
(SELECT NAME FROM BB_INGREDIENT WHERE SEQ=A.INGREDIENT09) INGREDIENT09_NAME
FROM BB_BURGER A, (SELECT * FROM BB_IMAGE WHERE TABLE_NAME='BB_BURGER') B, BB_MEMBER C
WHERE A.SEQ = B.REF_SEQ(+)
AND A.CREATOR = C.SEQ(+)
ORDER BY SEQ 
</select>

<!--등록한후 해당 재료시퀀스번호를 통해 재료 이름뽑아오기-->
<select id="getBurgerIngredientForBurgerTB" resultType="bba.com.a.model.Bb_BurgerDto">
SELECT
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT BREAD FROM BB_BURGER WHERE SEQ=#{seq} )),'') BREAD_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT01 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT01_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT02 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT02_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT03 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT03_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT04 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT04_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT05 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT05_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT06 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT06_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT07 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT07_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT08 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT08_NAME,
 NVL((SELECT NAME FROM BB_INGREDIENT WHERE SEQ=(SELECT INGREDIENT09 FROM BB_BURGER WHERE SEQ=#{seq} )),'') INGREDIENT09_NAME
FROM BB_BURGER 
WHERE SEQ=#{seq}
</select>

<!--버거등록-->
<insert id="registerBurger">
 INSERT INTO BB_BURGER(SEQ, NAME,BREAD,INGREDIENT01 ,INGREDIENT02, INGREDIENT03,
 INGREDIENT04,  INGREDIENT05,  INGREDIENT06,  INGREDIENT07,  INGREDIENT08,  INGREDIENT09, 
 CREATOR, PRICE, CAL, DEL) 
 VALUES(BB_BURGER_SEQ.NEXTVAL, #{name},#{bread} ,#{ingredient01}, #{ingredient02}, #{ingredient03},
#{ingredient04},#{ingredient05},#{ingredient06},#{ingredient07},#{ingredient08},#{ingredient09},
#{creator}, #{price}, #{cal}, 0)
 <selectKey keyProperty="seq" resultType="Integer" order="AFTER"> 
 SELECT BB_BURGER_SEQ.CURRVAL FROM dual 
 </selectKey>
</insert>


<!--재료 이미지 -->
<insert id="registerburgerImage" parameterType="bba.com.a.model.Bb_ImageDto">
 INSERT INTO BB_IMAGE(SEQ, TABLE_NAME ,WHAT_IMAGE ,IMAGE_SRC, REF_SEQ, DEL) 
 VALUES(BB_IMAGE_SEQ.NEXTVAL, #{table_Name}, #{what_Image}, #{image_Src}, #{ref_Seq}, 0)
  <selectKey keyProperty="seq" resultType="Integer" order="AFTER"> 
 SELECT BB_IMAGE_SEQ.CURRVAL FROM dual 
 </selectKey>
</insert>








</mapper>